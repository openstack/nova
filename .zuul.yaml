- job:
    name: nova-dsvm-multinode-base
    parent: legacy-dsvm-base-multinode
    description: |
      Base job for multinode nova devstack/tempest jobs.
      Will setup firewall rules on all the nodes allowing them to talk to
      each other.
    timeout: 10800
    required-projects:
      - openstack-infra/devstack-gate
      - openstack/nova
      - openstack/tempest
    irrelevant-files:
      - ^(placement-)?api-.*$
      - ^(test-|)requirements.txt$
      - ^.*\.rst$
      - ^.git.*$
      - ^doc/.*$
      - ^nova/hacking/.*$
      - ^nova/locale/.*$
      - ^nova/tests/.*$
      - ^releasenotes/.*$
      - ^setup.cfg$
      - ^tests-py3.txt$
      - ^tools/.*$
      - ^tox.ini$
    nodeset: legacy-ubuntu-xenial-2-node

- job:
    name: nova-tox-functional
    parent: openstack-tox
    description: |
      Run tox-based functional tests for the OpenStack Nova project with Nova
      specific irrelevant-files list. Uses tox with the ``functional``
      environment.
    irrelevant-files:
      - ^.*\.rst$
      - ^api-.*$
      - ^doc/source/.*$
      - ^nova/locale/.*$
      - ^placement-api-ref/.*$
      - ^releasenotes/.*$
    vars:
      tox_envlist: functional
    timeout: 3600

- job:
    name: nova-live-migration
    parent: nova-dsvm-multinode-base
    run: playbooks/legacy/nova-live-migration/run.yaml
    post-run: playbooks/legacy/nova-live-migration/post.yaml

- project:
    templates:
      - openstack-python-jobs
      - openstack-python35-jobs
      - publish-openstack-sphinx-docs
      - periodic-stable-jobs
      - check-requirements
      - integrated-gate
      - integrated-gate-py35
      - release-notes-jobs
    check:
      jobs:
        # We define our own irrelevant-files so we don't run the job
        # on things like nova docs-only changes.
        - ironic-tempest-dsvm-ipa-wholedisk-bios-agent_ipmitool-tinyipa:
            voting: false
            # This irrelevant-files list should match nova-dsvm-base.
            # TODO(mriedem): Define a node anchor to deduplicate this.
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - nova-live-migration
        - nova-tox-functional
        - neutron-grenade-multinode:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-grenade-dsvm-neutron-multinode-live-migration:
            voting: false
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^api-.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*\.py$
              - ^nova/tests/functional/.*$
              - ^nova/tests/unit/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-full-devstack-plugin-ceph:
            voting: false
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - neutron-tempest-linuxbridge:
            irrelevant-files:
              - ^(?!nova/network/.*)(?!nova/virt/libvirt/vif.py).*$
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - tempest-multinode-full:
            voting: false
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - tempest-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - neutron-grenade:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
    gate:
      jobs:
        - nova-live-migration
        - nova-tox-functional
        - tempest-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - neutron-grenade:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
    post:
      jobs:
        - openstack-tox-cover
    experimental:
      jobs:
        - legacy-tempest-dsvm-nova-v20-api:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-multinode-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-neutron-dvr-multinode-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - neutron-tempest-dvr-ha-multinode-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-neutron-src-oslo.versionedobjects:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-nova-libvirt-kvm-apr:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-grenade-dsvm-neutron-multinode-zero-downtime:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - ironic-tempest-dsvm-ipa-wholedisk-agent_ipmitool-tinyipa-multinode:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^.git.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^tests-py3.txt$
        - legacy-tempest-dsvm-full-devstack-plugin-nfs:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
        - legacy-tempest-dsvm-neutron-pg-full:
            irrelevant-files:
              - ^(placement-)?api-.*$
              - ^(test-|)requirements.txt$
              - ^.*\.rst$
              - ^.git.*$
              - ^doc/.*$
              - ^nova/hacking/.*$
              - ^nova/locale/.*$
              - ^nova/tests/.*$
              - ^releasenotes/.*$
              - ^setup.cfg$
              - ^tests-py3.txt$
              - ^tools/.*$
              - ^tox.ini$
